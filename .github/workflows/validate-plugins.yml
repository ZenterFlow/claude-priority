name: Validate Plugins

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: Validate All Plugins
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Make scripts executable
        run: |
          chmod +x plugin-formatter/skills/plugin-formatter/scripts/*.sh

      - name: Validate plugin-formatter
        run: |
          echo "ğŸ” Validating plugin-formatter..."
          ./plugin-formatter/skills/plugin-formatter/scripts/validate-naming.sh plugin-formatter
          ./plugin-formatter/skills/plugin-formatter/scripts/validate-json.sh plugin-formatter
          ./plugin-formatter/skills/plugin-formatter/scripts/validate-frontmatter.sh plugin-formatter

      - name: Validate claude-prioritise
        run: |
          echo "ğŸ” Validating claude-prioritise..."
          ./plugin-formatter/skills/plugin-formatter/scripts/validate-naming.sh claude-prioritise
          ./plugin-formatter/skills/plugin-formatter/scripts/validate-json.sh claude-prioritise
          ./plugin-formatter/skills/plugin-formatter/scripts/validate-frontmatter.sh claude-prioritise

      - name: Validate marketplace.json
        run: |
          echo "ğŸ” Validating marketplace.json..."
          python3 -m json.tool .claude-plugin/marketplace.json > /dev/null
          echo "âœ… marketplace.json is valid JSON"

      - name: Summary
        if: success()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… All plugins validated successfully!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ“ plugin-formatter"
          echo "âœ“ claude-prioritise"
          echo "âœ“ marketplace.json"
          echo ""
          echo "All plugins comply with Claude Code marketplace standards."
